<h2>People</h2>
<div id="peoplePanel" class="col-sm-6 pd-panel">
    <div class="panel panel-default">
        <div class="panel-heading">List of Employees</div>
        <div class="panel-body">
            <table id="peopleTable" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Employee Id</th>
                    </tr>
                </thead>
                @*<tfoot>
                    <tr>
                        <th>Name</th>
                        <th>Employee Id</th>
                    </tr>
                </tfoot>*@
            </table>
        </div>
    </div>
</div>
<div id="personInfo" class="col-sm-6 pd-panel">
    <div class="panel panel-default">
        <div class="panel-heading">Position Details</div>
        <div class="panel-body">
            <div id="init-message">Select an employee from the list.</div>
            <div id="person-info" style="visibility:hidden">
                <h4 id="personName"></h4>
                <table id="positionAssignmentsTable" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Home Dept.</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="clear"></div>
<script>
    $(function () {

        // peopleTable - initialization
        $('#peopleTable').dataTable({
            select: {
                style: 'single'
            },
            "iDisplayLength": 100,
            "sPaginationType": "full_numbers",
            processing: true,
            serverSide: true,
            info: false,
            "scrollY": "400px",
            "scrollCollapse": true,
            ajax: {
                url: '/api/people',
                type: "post",
                contentType: "application/json",
                data: function (d) {
                    // note: d is created by datatable, the structure of d is the same with DataTableParameters model above
                    //console.log(d);
                    return JSON.stringify(d);
                }
                ////DEBUG: Enable the following "success" handler to show data on the console instead of on the table.
                //, success: function (response) { console.log(response); res = response; }
            },
            "columns": [
                { "data": "name" },
                { "data": "empId" }
            ],
            rowId: "id"
        }); //ENDS: $('#peopleTable').dataTable({ xxx

        // peopleTable - on selection of a row
        var peopleTable = $('#peopleTable').DataTable();
        peopleTable.on('select', function (e, dt, type, indexes) {
            if (type === 'row') {
                var id = peopleTable.rows(indexes).data().pluck('id')[0];
                var name = peopleTable.rows(indexes).data().pluck('name')[0]
                //console.log(id);

                $('#personInfo .panel-body #init-message').hide();
                $('#personInfo .panel-body #personName').html(name);
                $('#personInfo .panel-body #person-info').css({ 'visibility': '' });
                // do something with the ID of the selected items
                showPositionInfo(id)
            }
        }); //ENDs: peopleTable.on('select, xxx


        // positionAssignmentsTable - Initialization
        $('#positionAssignmentsTable').dataTable({
            paging: false,
            searching: false,
            processing: true,
            serverSide: true,
            info: false,
            "deferLoading": 0, //Makes sure the ajax call is not made during initilization.
            ajax: {
                url: '',
                type: "post",
                contentType: "application/json",
                data: function (d) {
                    // note: d is created by datatable, the structure of d is the same with DataTableParameters model above
                    //console.log(d);
                    return JSON.stringify(d);
                }
                ////DEBUG: Enable the following "success" handler to show data on the console instead of on the table.
                //, success: function (response) { console.log(response); res = response; }
            },
            "columns": [
                { "data": "positionTitle" },
                { "data": "primaryDepartment" },
                { "data": "startDate" },
                { "data": "endDate" }
            ],
            rowId: "id"
        }); //ENDS: $('#positionAssignmentsTable').dataTable({ xxx

    }); //ENDS: $(function () { xxxx

   // This method is invoked when a person is selected from the people table
    function showPositionInfo(personId) {
        var table = $('#positionAssignmentsTable').DataTable();
        table.ajax.url('/api/people/' + personId).load();

    }

</script>